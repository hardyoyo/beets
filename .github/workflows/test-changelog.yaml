name: Temporarily test changelog formatting
on:
  pull_request:

jobs:
  build:
    name: Get changelog
    runs-on: ubuntu-latest
    outputs:
      changelog: ${{ steps.generate_changelog.outputs.changelog }}
    steps:
      - uses: actions/checkout@v4
        with:
          ref: master

      - name: Install Python tools
        uses: BrandonLWhite/pipx-install-action@v0.1.1
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: poetry

      - name: Install dependencies
        run: poetry install --with=release --extras=docs

      - name: Install pandoc
        run: sudo apt update && sudo apt install pandoc -y

      - name: Obtain the changelog
        id: generate_changelog
        run: |
          {
            echo 'changelog<<EOF'
            poe --quiet changelog
            echo EOF
          } >> "$GITHUB_OUTPUT"
  test:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    needs: build
    env:
      CHANGELOG: ${{ needs.build.outputs.changelog }}
    steps:
      - uses: mshick/add-pr-comment@v2
        with:
          message: |-
            ### Commit: ${{ github.sha }}
            ### Changelog:

            ${{ env.CHANGELOG }}
